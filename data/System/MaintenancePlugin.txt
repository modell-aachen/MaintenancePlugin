%META:TOPICPARENT{name="Plugins"}%
---+ MaintenancePlugin

Q.wiki maintenace plugin.
---++ MP_LIST

Lists registered checks.

%MP_LIST%

---++ MP_CHECK

If User is admin user and mpcheck=1, check for maintenance problems and list them as a table. %BUTTON{"Check now!" href="%SCRIPTURLPATH{"view"}%/%WEB%.%TOPIC%?mpcheck=1"}%

%MP_CHECK%
---++ API version 3

---+++ registerCheck( $name, $newcheck )
You can use the registerCheck API to add your own checks to the MaintenancePlugin.
   * =$name= the technical name of the check. Can overwrite existing checks.
   * =$newcheck= a reference to a hash containing:
      * =name= - Common name of a the checked item
      * =description= - Description of the detected problem
      * =check= - a reference to a perl subroutine, which must return a hash reference structured as follows
         * =result= - =0= if no error is found, =1= if no error is found.
         * =priority= - mandatory if =result= is not =0=. Defines the severity of the found error.
            * =0= - CRITICAL
            * =1= - ERROR
            * =2= - WARNING
         * =solutiony= - mandatory if =result= is not =0=. Text containgin information on how to solve the problem.
      * =experimental - , optional

*Example*

<verbatim>
registerCheck( "general:replaceifeditedagainwithin", {
    name => "ReplaceIfEditedAgainWithin set correctly",
    description => "{ReplaceIfEditedAgainWithin} set to 0",
    check => sub {
        my $result = { result => 0 };
        if ( ( exists $Foswiki::cfg{ReplaceIfEditedAgainWithin} ) and ( $Foswiki::cfg{ReplaceIfEditedAgainWithin} != 0 ) ) {
            $result->{result} = 1;
            $result->{priority} = WARN;
            $result->{solution} = "Set {ReplaceIfEditedAgainWithin} to 0";
        }
        return $result;
   }
);
</verbatim>

---++  Restrictions / Known Bugs

   * The file permission check is experimental. If it runs into files containing characters not in the locale-defined \w, such as german umlauts, the resulting search with File::Find will taint the result, which will cause the check to fail. Since we can not really change File::Grep's unicode settings, we suggest moving using the rename functionality to rename the page and change all incoming links. Will be automated soonish. Sorry. %BUTTON{"Check excluding experimental checks" href="%SCRIPTURLPATH{"view"}%/%WEB%.%TOPIC%?mpcheck=safe"}%

---++ Plugin Info

|  Author: | Maik Glatki |
|  Copyright: | &copy; 2015, Modell Aachen GmbH |
|  License: | GPL ([[http://www.gnu.org/copyleft/gpl.html][GNU General Public License]]) |
|  Release: | %$RELEASE% |
|  Version: | %$VERSION% |
|  Change History: | <!-- versions in reverse order --> |
|  0.3 | Added optional experimental tag to checks. Changed API version to 3. |
|  CPAN Dependencies | None |
|  Home | http://www.modell-aachen.de |
|  Feedback | glatki(at)modell-aachen(dot)de |

